#!/usr/bin/env bash

terminal="gnome-terminal"
editor="micro" #(micro / nano / vi)
bin_openf="openf"

if [ "$#" -eq 1 ]; then
    cd "$1"
fi

clear
echo ""
work_dir=`pwd`
work_dir=${work_dir//$HOME/}
if [[ $work_dir = "" ]]; then
	work_dir="/ ðŸšï¸";
fi
echo "$work_dir ðŸ”¨"
echo ""

i=-1
files=()
for f in `ls -a`; do
	if [ -d $f ]; then
		if [[ $f = "." ]]; then
			((i++))
			emoji='ðŸ”„';
			files[$i]=$f
			echo -e "$i\t $emoji update"
		elif [[ $f = ".git" ]] || [[ $f = ".github" ]]; then
			((i++))
			emoji='ðŸ™';
			files[$i]=$f
			echo -e "$i\t $emoji $f"
		else
			((i++))
			emoji='ðŸ“';
			files[$i]=$f
			echo -e "$i\t $emoji $f"
		fi
	else
		if [[ $f = "."* ]]; then
			if [[ $f = ".gitignore"* ]]; then
				((i++))
				emoji='ðŸ™';
                files[$i]=$f
				echo -e "$i\t $emoji $f"
			elif [[ $f = ".dockerignore"* ]]; then
				((i++))
				emoji='ðŸ³'
                files[$i]=$f
				echo -e "$i\t $emoji $f"
			fi
		else
			if [[ $f = *".sh" ]]; then
				emoji='ðŸ§';
			elif [[ $f = *".deb" ]]; then
				emoji='ðŸ“¦';
			elif [[ $f = *".apk" ]]; then
				emoji='ðŸ“±';
			elif [[ $f = *".appimage" ]] || [[ $f = *".exe" ]]; then
				emoji='âš™ï¸';
			elif [[ $f = "DOCKERFILE" ]]; then
				emoji='ðŸ³';
			elif [[ $f = *".yaml" ]]; then
				emoji='ðŸš¢';
			elif [[ $f = *".7z" ]] || [[ $f = *".rar" ]] || [[ $f = *".tar"* ]] || [[ $f = *".z" ]] || [[ $f = *".zip" ]]; then
				emoji='ðŸ—œï¸';
			elif [[ $f = *".mp3" ]] || [[ $f = *".wav" ]] || [[ $f = *".ogg" ]]; then
				emoji='ðŸŽ¹';
			elif [[ $f = *".mp4" ]] || [[ $f = *".mov" ]] || [[ $f = *".wmv" ]] || [[ $f = *".avi" ]]; then
				emoji='ðŸŽ¬';
			elif [[ $f = *".ico" ]] || [[ $f = *".jpeg" ]] || [[ $f = *".jpg" ]] || [[ $f = *".png" ]] || [[ $f = *".webp" ]] || [[ $f = *".svg" ]] || [[ $f = *".psd" ]]; then
				emoji='ðŸ–¼ï¸';
			elif [[ $f = *".rb" ]]; then
				emoji='ðŸ’Ž';
			elif [[ $f = *".py" ]] || [[ $f = *".ipynb" ]]; then
				emoji='ðŸ';
			elif [[ $f = *".php" ]]; then
				emoji='ðŸ˜';
			elif [[ $f = *".rust" ]]; then
				emoji='ðŸ¦€';
			elif [[ $f = *".go" ]]; then
				emoji='ðŸ­';
			elif [[ $f = *".dart" ]]; then
				emoji='ðŸ’‰';
			elif [[ $f = *".java" ]] || [[ $f = *".jar" ]]; then
				emoji='â˜•';
			elif [[ $f = *".html" ]]; then
				emoji='ðŸŒ';
			elif [[ $f = *".css" ]]; then
				emoji='ðŸ”®';
			elif [[ $f = *".js" ]]; then
				emoji='ðŸª';
			elif [[ $f = *".c" ]]; then
				emoji='ðŸ©';
			elif [[ $f = *".asm" ]]; then
				emoji='ðŸ¤';
			elif [[ $f = *".db" ]] || [[ $f = *".sqlite" ]] || [[ $f = *".sql" ]]; then
				emoji='ðŸ›¢ï¸';
			elif [[ $f = *".txt" ]] || [[ $f = *".csv" ]] || [[ $f = *".json" ]]; then
				emoji='ðŸ“ƒ';
			elif [[ $f = *".md" ]] || [[ $f = *".MD" ]]; then
				emoji='â™';
			elif [[ $f = "LICENSE" ]]; then
				emoji='ðŸ“œ';
			elif [[ $f = *".log" ]]; then
				emoji='ðŸªµ';
			else
				emoji='ðŸ“„';
			fi
			((i++))
            files[$i]=$f
			echo -e "$i\t $emoji $f"
		fi
	fi
done 

echo ""
read userselect

echo ""
if [[ $userselect = "run -"* ]]; then
	remove_run="run - "
	run_command=${userselect//$remove_run/}
	bash ~/.bash_aliases
	run_output=$(eval "$run_command" 2>&1)
	echo "$run_output"
	echo ""
	echo "â†©"
	read return
	. $bin_openf
fi

if [[ -z $userselect ]]; then
	sleep 0.3
	. $bin_openf
elif [[ $userselect =~ ^[0-9]+$ ]]; then
	if [[ ${files[$userselect]} ]]; then
		selected_file="${files[$userselect]}"
		if [[ -d $selected_file ]]; then
			cd "$selected_file"
			. $bin_openf
		else
			$terminal -- $editor "$selected_file"
			sleep 0.5
			. $bin_openf
		fi
	else
		echo "Invalid selection."
		sleep 0.3
		. $bin_openf
	fi
else
	if [[ -e $userselect ]]; then
		if [[ -d $userselect ]]; then
			cd "$userselect"
			. $bin_openf
		else
			$terminal -- $editor "$userselect"
			sleep 0.5
			. $bin_openf
		fi
	else
		echo "Invalid selection."
		sleep 0.3
		. $bin_openf
	fi
fi

echo ""
